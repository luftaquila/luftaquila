---
title: 4. 차단 회로와 제동등
description: E-포뮬러 전기시스템 제작기
category: e-formula
assets: /assets/posts/e-formula/2022-05-28-shutdown
image: /assets/posts/e-formula/2022-05-28-shutdown/shutdown.png
layout: post
published: false
---

{% include_relative index.md %}

## 차단 회로 개요
차단 회로의 주 역할은 LV 배터리의 12V 전원을 원하는 곳에, 원하는 상황에만 전달하는 것이다. 특히 AIR의 전원을 통제하여 AIR를 켜고 끄는 것을 주 목적으로 한다. 회로도는 다음과 같다.

<div class='center'><img src='{{ page.image }}'></div>

회로도 왼쪽과 오른쪽 위의 라벨들은 모두 외부 회로에 연결된 단자이다. `LV`와 `LV_ACTIVE` 라벨이 여러 개인 것은 같은 전원(LV), 신호(LV_ACTIVE)를 다른 여러 외부 회로가 사용하기 떄문이다. 차단 회로는 차량의 모든 전원을 통제한다. 차량의 전기시스템에서 차단 회로를 통하지 않고 LV 배터리에서 전원을 공급받는 것은 모터 냉각용 워터펌프와 라디에이터 팬밖에 없다.

### 회로 동작
1. 차단 회로는 LV 배터리로부터 12V 전원을 `LV_BATT` 단자를 통해 공급받는다. 드라이버가 LV 마스터 스위치인 `LV_MASTER`를 눌러 LV 전원을 켜면, `LV` 라벨들은 모두 `LV_BATT`과 연결되어 전원을 공급받기 시작한다. 모터 컨트롤러(`LV_INV`), TSAL LED(`LV_TSAL`), 배터리 팩(`LV_PACK`), 대시보드 마이크로컨트롤러(`LV_MCU`)가 LV start 시 전원을 공급받는 요소들이다. 앞으로 우리는 이 상태를 **LV 활성화**라고 부를 것이다.<br><br>한편, 이 회로들이 전원을 바로 공급받지 않고 릴레이를 통해 공급받는 것은 전류 때문이다. 모터 컨트롤러가 2A 정도를 소모하는 등 LV 공급 라인이 최소 5A는 흘려줄 수 있어야 하는데, 이 정도 전류를 PCB 패턴이 감당하려면 배선 너비가 5mm가 넘어야 한다. 따라서 LV 전원은 PCB 대신 별도의 외부 배선을 통해 전원을 공급받게 된다.

1. `LV_MASTER` 뒤의 HV 보조 비상정지 스위치인 `HV_AUX`들과 제동계통 미작동 감지장치 `BOTS`는 초기 상태가 눌린 상태이다(Normal Closed, NC). 이 스위치들은 문제가 있을 때 작동하여 회로를 끊어 LV 전원이 AIR에 전달되지 못하게 한다.

1. 다음은 래칭 릴레이들이다. 이 3개의 래칭 릴레이는 FAULT 신호를 받는 소스만 다를 뿐 동일하게 작동한다. 다른 릴레이들은 전원이 끊기면 상태를 유지하지 못하는 반면, 래칭 릴레이는 전원이 끊겨도 자신의 상태를 유지한다. 동작 코일과 리셋 코일, 총 2개의 코일을 가지고 있으며, 12V를 공통으로 공급받고 각 코일의 -단자가 하나씩 있다. 동작 코일의 -단자에 GND를 연결하면 전류가 흘러 코일이 작동하고 그 상태를 유지한다. 이를 되돌리는 방법은 리셋 코일의 -단자에 GND를 연결하는 것밖에 없다.  <br><br>
*차량기술규정 제 11장 차단 회로와 퓨징 제55조 6항*에 따라, BMS, IMD, BSPD에 문제가 생겼을 경우 구동계통은 수동으로 재설정하기 전까지 비활성화 상태를 유지해야 한다. LV를 껐다 켠다고 해서 재활성화시킬 수 있으면 안 된다는 말이다. 래칭 릴레이는 이 규정을 충족시키기 위해 존재한다.  <br><br>
BMS, IMD, BSPD의 FAULT 라인은 정상 상태일 때 HIGH(12V), 문제가 있을 때 LOW(0V)를 출력한다. 문제가 있을 때 0V가 래칭 릴레이의 동작 코일에 공급되면 래칭 릴레이는 차단 회로를 끊는다. 이는 GND와 연결된 수동 리셋 버튼(`SHUTDOWN_RESET`)을 누르기 전까지 초기화되지 않는다.  <br><br>
한편, BMS, IMD, BSPD의 FAULT 신호에는 LED 핀이 하나씩 붙어 대시보드로 간다. 이 LED들은 평소에는 켜져 있지만 문제가 생기면 꺼져 운전석에서 즉시 어떤 요소에 문제가 생겼는지 파악할 수 있게 해 준다. 마찬가지로 래칭 릴레이의 동작 코일이 작동하면 12V 배선은 `CRITICAL_LED` 단자로 연결된다. 이 단자 또한 대시보드에 연결되어 BMS, IMD, BSPD 중 문제가 생긴 요소가 단 하나라도 있다면 점등한다.

1. 그 뒤는 HVD 인터락 배선이다. HVD가 분리되면 인터락 또한 분리되며 차단 회로를 끊는다.

1. 다음은 HV 마스터 스위치인 `HV_MASTER`이다. 다른 모든 회로 요소가 정상 작동하고 있을 때, 드라이버가 HV 마스터 스위치를 누르면 비로소 HV가 활성화되며 `LV_ACTIVE`가 HIGH 상태가 된다.

HV 마스터 다음의 `RELAY_AIR+_ACTIVE` 릴레이에 관해서는 다음의 <a style='font-weight: bold' href="https://luftaquila.io/blog/e-formula/precharge-discharge/">초기충전과 방전 회로</a>에서 다루도록 하자.


## 제동등
제동등 회로는 차단 회로 좌측 상단 `LV_MASTER`와 `HV_AUX1` 사이에 있다. 제동등은 단순하게 12V를 공급받아 켜지는 적색 LED 어레이이다. 브레이크를 밟았을 때 이 LED를 점등하기 위해 우리는 브레이크 ON/OFF 스위치를 사용한다. 브레이크 ON/OFF 스위치는 브레이크 압력 센서와 다르게 브레이크가 조금만 밟혀도 작동하는 단순한 스위치이다.

제동등은 LED 수십 개를 동시에 켜므로 전류를 상당히 많이 먹는다. 브레이크 스위치를 통해 바로 전류를 공급하면 전선이 타버릴 수 있다. 또한 RTD 모드의 관리를 위해 MCU 또한 브레이크 작동 여부를 감지할 수 있어야 하므로 우리는 MOSFET을 사용한다. MOSFET의 GATE는 평소에는 10kΩ 저항을 통해 GND로 PULL-DOWN되어 있다가, 브레이크를 밟으면 12V가 되어 MOSFET을 작동시키고 제동등을 켜게 된다.

{% include_relative index.md %}
