---
title: 3. TSAL & VI
description: E-포뮬러 전기시스템 제작기
category: e-formula
assets: /assets/posts/e-formula/2022-05-27-tsal-vi
image: /assets/posts/e-formula/2022-05-27-tsal-vi/tsal_vi.png
layout: post
---

{% include_relative index.md %}

## TSAL 개요
TSAL, Tractive System Active Light는 개요에서 설명한 것처럼 LV일 때 녹색, HV일 때 적색으로 차량의 전기계통 활성화 상태를 표시하는 장치이다. 한국자동차공학회 Formula 차량기술규정 제10장 전기시스템 제53조 고전압 표시등에 관련 규정이 있다.  

규정에 따라 TSAL의 LED는 야외 햇빛 아래에서도 반경 3m 이내에서 확실하게 식별할 수 있는 밝기여야 한다. 또한 LV로 작동하되, HV 전압을 감지하여 작동해야 한다. 이 말은 회로가 LV와 HV의 전압을 비교할 수 있어야 한다는 말이다. 목차 1번 <a style='font-weight: bold' href="https://luftaquila.io/blog/e-formula/introduction/">들어가며</a>의 *접지* 문단을 다시 한 번 읽어보자. 전압을 비교하려면, 기준점이 같아야 한다. 기준점이 같다는 것은 그라운드를 공유한다는 뜻이며 이는 전혀 절연 상태가 아니라는 말이다.  

뭔가 이상하지 않은가? HV와 LV는 어떠한 상황에서도 절연을 유지해야 하는데, 비교하려면 절연을 포기해야 한다. 이 말도 안 되는 상황을 해결하기 위해 우리는 SPAN02A-12나 MUS1212와 같은 절연형 12V DC-DC 컨버터를 사용한다. 이 아이들은 그냥 간단하게 12V를 입력받아 12V를 출력하는 친구다. 이 기능밖에 없다면 존재가치가 없겠지만 이 아이들은 입력과 출력이 완전히 절연되어 있다. 그래서 LV 배터리 전원을 이 컨버터에 통과시키면 LV와 완벽하게 절연된 12V 전원을 만들어낼 수 있다. 이 전원의 그라운드를 HV-와 연결하면 LV를 통해 전원을 공급받으면서도 LV와는 절연된 12V 레퍼런스를 갖게 되는 것이다.
<div class='center'><img src='{{ page.assets }}/tsal.png'></div>

### 회로 동작
#### HV 영역
TSAL은 먼저 4M7 저항 4개로 이루어진 전압 분배 회로를 통해 12V 레퍼런스 전압을 1/4로 나눈다. 12V는 고정이므로 나눠진 전압은 항상 3V이다. 이 3V 레퍼런스 전압은 LM311 비교기의 3번 입력 핀으로 들어간다.  

한편, HV 전압은 4M7 저항 4개와 1M 저항으로 이루어진 전압 분배 회로를 통해 1/20으로 나누어 LM311의 2번 핀으로 입력된다. 한국자동차공학회 규정상 HV는 60V 이상이므로 HV 전압이 60V보다 높아지는 순간 TSAL이 작동되어야 한다. 60V는 1/20으로 나누면 3V이므로, HV가 60V보다 커지면 분배된 전압은 3V보다 높아지게 된다.

LM311은 이 두 전압을 비교해 2번 핀 전압이 더 크다면 HIGH를, 3번 핀 전압이 더 크다면 LOW를 7번 핀으로 출력한다. 이 신호는 2.2kΩ 전류 제한 저항을 통과하여 4N36 포토커플러를 작동시킨다.  

* HV 전압 분배 회로 뒤의 제너다이오드는 LM311에 입력되는 전압을 최대 12V로 제한하기 위함이다. 제너다이오드의 동작은 별도로 찾아보길 바란다. LM311의 입력 핀 전압은 최대 15V인데, 우리 HV 배터리의 전압은 (3.3 ~ 4.2) * 70 = 231 ~ 294V이다. 이를 1/20으로 분배하면 11.6 ~ 14.7V가 되는데, 최대 전압인 14.7V가 LM311의 입력 한계에 매우 가깝기 때문에 이를 12V로 깎는 것이다. 어차피 HV가 60V보다 크다면 2번 핀 전압은 3V보다 커져 항상 LM311을 작동시키기 때문에 동작에는 아무 문제가 없다.
* 전압 분배 회로에 높은 저항값을 사용하는 것은 LM311과 같은 IC 회로는 전압으로 동작하는 논리 회로이지, 전류를 사용하는 회로가 아니기 때문이다. HV는 결국 구동계통 전원이므로 고전압으로 인한 과전류를 방지하기 위해서도, 모터에 쓸 배터리를 아끼기 위해서도 높은 저항값을 사용하여 손해볼 것은 없다.
* LM311의 2번 핀과 3번 핀 사이 커패시터는 노이즈 필터링을 위한 것이다.
* LM311 주변의 1uF 커패시터와 10kΩ 저항은 LM311을 동작시키기 위한 주변 회로이다.

#### LV 영역
TSAL의 녹색, 적색 LED는 LV로 동작한다. 따라서 LM311의 비교 출력을 절연을 유지한 상태로 LV로 전달해주어야 하기 때문에 포토커플러를 사용한다. 포토커플러를 통해 LM311의 출력 신호는 LV 측으로 전달되고, 출력이 HIGH라면 맨 오른쪽 MOSFET을 작동시켜 적색 LED를 점등한다. 만약 출력이 LOW라면 가운데 MOSFET과 저항이 만드는 NOT게이트를 통과하여 HIGH로 반전된 값이 맨 왼쪽 MOSFET으로 전달되고, 녹색 LED를 점등한다.
<br>
<br>

## VI 개요
이제 VI를 살펴보자. Voltage Indicator는 배터리 팩의 HV가 활성화되어 있는지 여부를 보여주는 표시등이다. TSAL과 목적이 같으나 위치가 다르다. TSAL의 표시등은 차량 외부의 잘 보이는 곳에 부착되어야 하기 때문에 LED를 켜는 데 LV를 사용한다. TSAL의 LED를 켜는 데에 전압을 낮춘 HV를 사용한다면 운전자는 마음이 썩 편치 않을 것이다. 전압만 낮은, HV와 그라운드를 공유하는 TSAL LED가 명백하게 LV 그라운드인 차체 철제 프레임을 따라 배선되어야 하기 때문이다. 피복이 조금 벗겨지기라도 하면 바로 절연 파괴로 이어진다.

반면 VI는 어차피 HV가 난무하는 배터리 팩에 달리는 표시등이므로 이러한 걱정에서 보다 자유롭다. 따라서 VI의 표시등은 HV를 전압 강하시켜 점등한다. TSAL과 마찬가지로 HV 규정인 60V 이상일 때 점등되어야 한다.

### 회로 동작
<div class='center'><img src='{{ page.assets }}/vi.png'></div>
VI가 60V 이상일 때 점등되도록 하기 위해 60V 제너다이오드를 사용했다. 제너다이오드는 댐의 수문처럼 동작한다. 제너 다이오드는 입력 전압이 자신의 제너 전압 <code class="language-plaintext highlighter-rouge">V<sub>z</sub></code> 이하일 때 전압을 통과시키지 않는다. 입력 전압이 제너 전압 이상일 때는 연결 방식이 직렬이냐 병렬이냐에 따라 달라진다. 위의 우리 회로처럼 직렬로 연결한 경우에는 입력 전압에서 자신의 제너 전압을 뺀 만큼의 전압을 통과시킨다. 병렬 연결인 경우에는 입력 전압을 그대로 통과시킨다. 우리 회로는 직렬 연결이므로, 입력 전압에서 60V를 뺀 만큼의 전압을 뒤의 LR8로 전달한다. 실제로는 회로에 나온 것처럼 12V 제너 다섯 개를 직렬 연결했는데, 그 이유는 뒤에서 살펴보자.

#### 제너 다이오드
VI의 궁극적인 목표는 전압이 60V 이상일 때 LED를 점등하는 것이다. LED는 전류를 ~20mA 정도 소모한다. 그 말은 결국, 제너 다이오드가 20mA를 공급해줄 수 있어야 한다는 말이다. 한편, 제너다이오드는 대개 역방향 허용 전류 <code class="language-plaintext highlighter-rouge">I<sub>z</sub></code>가 그리 크지 않다. 5W 규격에 제너 전압이 60V인 1N5371의 제너 전류는 20mA이다. 설계 여유가 전혀 없다. 그래서 우리는 동일한 규격에 제너 전압이 12V인 1N5349를 사용한다. 1N5349의 제너 전류는 100mA이다. 제너 다이오드는 직렬로 연결하면 각각의 제너 전압의 합만큼 전압을 깎게 된다. 제너 전류가 더 크고 제너 전압은 더 낮은 다이오드를 직렬로 연결하여 제너가 20mA 이상을 공급할 수 있도록 해 주었다. 

#### 레귤레이터
다음 문제는 레귤레이터이다. 우리는 완전 방전 시 231V, 최대 충전 시 294V인 HV 전압에서 60V를 제너다이오드로 깎았다. 이제 전압 범위는 약 170 ~ 234V이다. 아직 LED를 켜기에는 턱없이 높다. 이 전압을 적색 LED 점등 전압인 2V 정도로 낮춰주기 위해 우리는 선형 레귤레이터(LDO)를 사용한다. LDO는 높은 전압을 입력받아 낮은 전압으로 바꿔 준다. 대개는 ~수십 V 정도를 수 V로 깎아주지만, 우리처럼 수백 V의 고전압을 깎아주는 LDO들도 있다. 우리는 LR8이나 TL783 정도를 고려했다.

LDO가 전압을 어떻게 깎느냐 하면 죄다 열로 태워서 깎는다. LDO의 발열량은 <dfn>(입력 전압 - 출력 전압) &times; 전류 (W)</dfn>이다. 우리의 입력 전압은 234V이고, 원하는 출력 전압은 5V이며 20mA가 흐르기를 바란다. 이 때 발열은 4.6W이다. 커봐야 손톱만 한 IC가 순식간에 5W짜리 따끈따끈한 손난로가 되어 버린다는 것이다. 말이 나온 김에 발열이 4.6W가 나오는 LR8의 칩 온도를 계산해 보자. 데이터시트를 보면, LR8의 열저항은 다음과 같다.
<div class='center'><img src='{{ page.assets }}/lr8.png'></div>

열저항에는 <dfn>θ<sub>jc</sub></dfn>과 <dfn>θ<sub>ja</sub></dfn>가 있다. <dfn>θ<sub>jc</sub></dfn>는 TO-220과 같은 패키징에 히트싱크를 사용했을 때의 온도 계산에 쓰인다. 우리는 일단 히트싱크 없이 공기중에서의 온도를 계산하기 위해 <dfn>θ<sub>ja</sub></dfn>를 사용할 것이다. 열저항은 1W마다 칩 온도가 몇 도 증가하는지를 알려주는 수치이다.

소자 온도 <dfn>T<sub>j</sub> = T<sub>a</sub> + <dfn>θ<sub>ja</sub></dfn> * P</dfn> 이다. <dfn>T<sub>a</sub></dfn>는 주변 공기의 온도이다. 데이터시트에 따르면 TO-92 패키징에서 LR8은 1W마다 온도가 170도 증가한다고 한다. 주변 온도가 30도라고 했을 때 4.6W 발열이 나는 칩의 온도는 812도이다. 드래곤도 구워먹을 수 있겠다. 절망했다.

한편, 같은 기능에 패키징이 TO-220인 TL783은 열저항이 <dfn>θ<sub>ja</sub> = 19°C/W</dfn>이다. 열저항이 압도적으로 낮고 TO-220 패키징이므로 히트싱크도 적용할 수 있다. 희망을 보았지만 데이터시트 보고 그대로 회로를 구성했음에도 전혀 원하는 대로 동작하지 않았다. LR8과 정확히 동일한 회로 구성으로 사용할 수 있는 소자임에도, LR8은 동작하는 회로에서 TL783은 동작하지 않았다. 결국 버리고 LR8로 갈아탔다.

물리법칙에 의해 4.6W는 오롯이 감당해야 하는 발열이다. 그렇다고 소자 하나가 그걸 전부 감당할 필요가 있을까? LR8 두 개를 적용해서 두 번 깎을 수도 있다. 각각 2.3W씩 감당하게 하는 것이다. 첫 번째 LR8은 회로의 두 저항을 이용해 전압을 100V로 강압한다. 이어서 두 번째 LR8이 100V를 5V로 깎고 LED를 켜게 된다.

<br>

{% include_relative index.md %}