---
title: 5. 초기충전과 방전 회로
description: E-포뮬러 전기시스템 제작기
category: e-formula
assets: /assets/posts/e-formula/2022-05-29-precharge-discharge
image: /assets/posts/e-formula/2022-05-29-precharge-discharge/precharge.png
layout: post
published: false
---

{% include_relative index.md %}

## 개요
초기충전과 방전 회로는 모두 모터 컨트롤러와 관련이 있다. 모터 컨트롤러는 모터를 제어하는 동시에 모터에 전력을 공급하는 역할도 한다. 우리 팀이 자동차를 구동하는 데 사용하는 모터는 교류 모터이다. 반면 HV 배터리는 직류이므로 이를 3상 교류 전원으로 바꾸어 모터를 구동하는데, 이 인버터의 역할 또한 모터 컨트롤러가 수행하는 것이다. 이러한 이유로 모터 컨트롤러는 HV를 필수적으로 사용하게 된다. 한편, 모터 컨트롤러는 내부 회로에 축전기(커패시터)를 가지고 있다. 초기충전/방전 회로는 모두 모터 컨트롤러에 포함된 HV 커패시터들로 인해 필요한 회로이다.

모터 컨트롤러에 내장된 커패시터의 정전 용량은 대개 제조사 데이터시트에 표기되어 있다. 우리 팀이 사용하는 PM100DX의 자체 정전용량은 <dfn>440uF</dfn>이다.
<div class='center'><img src='{{ page.assets }}/capacitance.png'></div>

### RC 회로
모터 컨트롤러가 자체 정전용량을 갖고 있다고 했으니, 모터 컨트롤러를 축전지로 한 번 형상화해 보자. RLC 회로가 기억나는가? 잠깐 고등학교 물리 시간이다.
<div class='center'><img src='{{ page.assets }}/example1.png'></div>
실제 우리가 사용하는 모든 전선은 약간의 자체 저항이 있다. 저항이 0인 전선 같은 건 이 세상에 존재하지 않는다. 그런게 필요하다면 상온 초전도체를 알아보시라. 우리는 대충 5Ω 정도로 잡아 보자.
<div class='center'><img src='{{ page.assets }}/cap_charge.gif'></div>
RC 회로에서 커패시터에 걸리는 전압과 흐르는 전류는 RC 시정수(τ 혹은 T)에 따라 변화한다. 전압은 점점 증가해 5τ 정도의 시간에서 전원 전압과 동일해지고, 전류는 반대로 점점 감소해 5τ 부근에서 0에 수렴한다. 회로가 연결된 시점인 0τ에서, 전류는 전원 전압을 저항으로 나눈 값과 동일하며 최대로 전류가 흐른다.

이것은 커패시터를 충전하는 경우이고, 방전할 때에는 전류와 전압 그래프가 서로 바뀌게 된다.

## 초기충전 회로 개요
우리의 전기차 시스템에서 전원을 연결한다는 것은 배터리 팩의 AIR를 닫아 294V 전원을 공급하는 것이다. AIR가 닫히는 순간 HV 라인에는 294 / 5 = 58.8(A)의 전류가 흐른다. RC 시정수 τ = RC인데, 이 회로에서 τ = 2.2ms가 된다. 5τ 지점에서 커패시터 충전이 99% 완료된다고 했는데, 충전이 완료되는 데까지 11ms밖에 걸리지 않는 셈이다. 이렇게 순간적으로 흐르는 큰 전류는 모터 컨트롤러의 회로를 손상시킬 수 있다. 따라서 우리는 회로에 저항을 추가해 RC 시정수를 증가시켜 보다 천천히 모터 컨트롤러의 커패시터를 충전시켜 손상을 방지해야 한다. 이것이 초기 충전 회로가 필요한 이유이다.
<blockquote style='font-size: 0.9rem'>
차량기술규정 제51조 (초기충전회로와 방전회로 - Pre-Charge Circuit and Discharge Circuit)<br><br>
① 두개 이상의 HV 릴레이(AIR) 중 마지막 HV 릴레이가(AIR) 닫히기 전에 구동시스템 전압이 축전지 전압의 90%까지 확보되도록 초기충전 회로를(Pre-charge Circuit) 구현해야 한다.(구동시스템에 축전지 전압이 그대로 인가될 경우 돌입 전류에 의해 인버터가 손상될 수 있음)<br>
④ 두개 이상의 HV 릴레이(AIR) 중 마지막 HV 릴레이가 닫히기 전에, 1초 이상의 시간 동안 구동시스템을 초기충전을 해야한다. 구동시스템의 순간 전압을 측정하는 피드백은 요구되지 않는다.
</blockquote>
이렇듯 차량기술규정에도 명시되어 있다.

초기충전은 HV 배터리 팩의 한 극에서 이루어진다. 순서는 다음과 같다.
<div class='center'><img src='{{ page.assets }}/precharge-overview.png'></div>
1. HV가 활성화되면 AIR-를 닫는다. AIR+는 열린 상태로 둔다.
2. 초기충전 릴레이를 닫아 초기충전을 시작한다. HV 전압은 초기충전 저항을 통해 모터 컨트롤러의 커패시터를 1초 이상 서서히 충전한다.
3. 모터 컨트롤러의 커패시터 전압이 HV 전압의 90% 이상으로 충전되면, AIR+를 닫아 HV 동력을 공급한다.
4. 초기충전 릴레이를 열어 초기충전을 종료한다.

초기충전을 위해 전압 분배 회로와 LM311 비교기, 555 Timer를 이용해 회로를 구성하는 방법도 있겠지만, 우리의 모터 컨트롤러 PM100DX는 초기충전 제어 기능이 있다. 몇 가지 설정을 하고 초기충전 회로를 구성한 후 초기충전 릴레이와 모터 컨트롤러를 연결해 주면 모터 컨트롤러가 알아서 전압을 모니터링하고 초기충전 단계를 수행한다.

한편, 초기충전 저항이 1kΩ이므로 RC 시정수 τ = 440ms이고, 초기충전이 완료되는 5τ까지의 소요 시간은 2.2초이다.

## 방전 회로 개요
모터 컨트롤러에 공급되는 HV가 끊기더라도 컨트롤러의 이 커패시터들은 여전히 HV가 충전된 상태로 유지되어 서서히 자연 방전된다. 이 커패시터들이 완전히 방전되기 전에 사람이 접촉하면 HV에 감전될 위험이 있다. 따라서 전원이 끊기면 이 커패시터들은 적절히 빠르게 방전되어야 한다. 여러모로 커패시터가 말썽이다.

이 방전 회로는 전기 안전과 직결되는 회로인 만큼, 어떠한 논리 제어에 의해 통제되어서는 안 된다. Fail-safety 원칙이 적용되어야 한다. 따라서 우리는 Normally Closed(NC) 릴레이를 사용한다.

<div class='center'><img src='{{ page.assets }}/discharge-overview.png'></div>

NC 릴레이인 방전 릴레이는 전원이 공급되지 않으면 항상 닫힌 상태로 유지되어 모터 컨트롤러 커패시터와 저항을 연결하고, 커패시터를 방전시킨다. HV 동력이 활성화되면 방전 릴레이는 전원을 공급받아 방전 회로를 개방해 불필요한 전력 손실을 막는다. 방전 릴레이는 어떠한 로직에 의해 HV 비활성화를 감지하고 작동하는 것이 아니라 단순히 전원 공급이 끊기면 자연스럽게 방전 저항을 회로에 연결하는 식으로 작동한다. 이 또한 차량기술규정에 명시되어 있다.

<blockquote style='font-size: 0.9rem'>
차량기술규정 제51조 (초기충전회로와 방전회로 - Pre-Charge Circuit and Discharge Circuit)<br><br>
⑤ 방전회로는 차단 회로가 개방되었을 때 항상 활성화되도록 설계되어야 한다. 또한, 고전압 분리기가(HVD) 분리되었을 때에도 방전될 수 있도록 설계되어야 한다.<br>
⑥ 제55조 ④항을 준수하기 위해 방전회로가 필요할 경우 최소 15초 동안 최대 방전 전류를 처리하도록 설계해야 한다.
</blockquote>

방전 저항은 초기충전 저항의 두 배이므로, RC 시정수도 두 배 증가하여 τ = 880ms이다. 따라서 방전 회로는 커패시터의 HV 전압을 99% 방전시키는 데 4.4초를 소요한다.

## 저항 및 릴레이 선정
### 릴레이
모터 컨트롤러 제조사에서는 초기충전에 허용 전류 30A의 자사 초기충전 릴레이를 사용하도록 권장하고 있다.
<div class='center'><img src='{{ page.assets }}/precharge-relay.png'></div>
그런데, 우리 팀의 설계대로 HV 전압이 294V이고 초기충전 저항이 1kΩ이라면 초기충전 전류는 최대 294 / 1000 = 294(mA)에 불과하다. 방전 회로의 경우 2kΩ 저항을 사용하므로 최대 전류는 절반인 150mA 정도가 된다.

제조사가 무슨 이유로 30A의 고전류 릴레이를 사용하라고 하는지 좀 께름칙하긴 했지만, 30A 릴레이는 하나에 10만 원이나 한다. 개당 900원인 JQ1-12V-F 릴레이도 허용 전류 5A로 충분히 초기충전/방전 전류를 처리할 수 있다.

### 저항
한편, 커패시터에 충전된 에너지 E = (CV<sup>2</sup>)/2이다. 우리 시스템의 경우 19J 가량이 된다. 초기충전 시간이 2.2초이므로 초기충전 저항은 2.2초에 걸친 19J의 에너지(발열)을 처리할 수 있으면 된다. 방전 회로는 4.4초에 걸쳐 같은 에너지를 처리할 수 있으면 된다.

저항에서 발생하는 발열 P = I<sup>2</sup>R이다. 초기충전 회로의 경우, 최대 전류는 294mA이며 저항은 1kΩ이다. 이 때 발열은 86.436(W)가 된다. 방전 회로에서는 최대 전류가 147mA, 저항은 2kΩ 이므로 43.218(W)의 발열이 발생한다. 우리는 여유있게 100W 권선 저항인 HSC1001K0J를 선정하였다.

이어서는 차단 회로의 제동계통 타당성 검증 장치인 BSPD 회로를 살펴보도록 하자.
<br><br>

{% include_relative index.md %}
