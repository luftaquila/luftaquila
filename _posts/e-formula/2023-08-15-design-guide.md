---
title: ¼. 시스템 설계 가이드
description: KSAE E-Formula 전기시스템 제작기
category: e-formula
assets: /assets/posts/e-formula/2023-08-15-design-guide
image: /assets/posts/e-formula/2023-08-15-design-guide/hvd_destruction_1.png
layout: post
---

{% include_relative index.md %}

## 디자인 가이드
만약 전기차를 아예 처음부터 설계하려고 한다면, 뭘 어디부터 시작해야 하고 부품은 어디서 무엇을 구해야 하며, 돈은 얼마나 드는지 등 감을 잡기 어려울 것이다. 그러나 이 시기의 결정은 앞으로의 차량 제작에 매우 큰 영향을 미치게 된다. 특히 모터나 모터 컨트롤러, BMS 같은 주요 부품들의 선정은 굉장히 중요한데, 되돌아보면 아무것도 모를 때 구매하는 부품이지만 각각 수백만 원씩 하고 배송에 여러 달이 걸리며, 차량 성능을 결정하는 핵심 요소이기 때문이다.

질문 중에 가장 많은 유형이기도 하고, 우리 팀 또한 처음에 잘 모르는 상황에서 이러한 부품을 선정하면서 시간을 많이 허비했기에 시스템을 설계할 때 어떤 의식의 흐름으로 부품의 스펙을 선정해야 하는지를 적어 보고자 한다.

신생 팀의 입장에서 기존 팀들이 어떤 부품을 사용하는지 알기가 쉽지 않을 것이다. 도움이 되었으면 하는 마음에 우리 팀이 사용한 부품들의 이름은 글에 적어 둘 것이지만, 한 가지 미리 언급하고 싶은 것은 여기 적어 둔 부품들이 정답은 아니라는 것이다. 나 또한 다른 팀들은 어떤 부품을 사용하는지 잘 알지 못하고, 우리 팀도 세상의 많고 많은 제품 중 단 한 가지씩만을 사용해보았을 뿐이라는 것을 밝혀 둔다.

<del><span style="font-size: .8rem">그런데 경험상 대부분의 팀들이 비슷비슷한 제품을 사용하고 있는 것 같긴 하다(특히 모터와 BMS). 아무튼 차 굴려봤던 누구네가 이거 쓴다더라 하면 따라 사는 경향이 짙다.</span></del>

### 그래서 뭐 쓰시는데요
우리 팀은 모터로 Emrax 208 Medium Voltage 모델의 LC(수냉)식 버전을, 모터 컨트롤러로 Cascadia Motion의 PM100DX Gen 3를, BMS로 Orion BMS 2를 사용한다. HV 배터리에는 삼성 SDI의 INR21700-40T 셀 490개를 70s7p 구성으로 사용하고 있다.

### 왜요?
1. 클래스  
일단 제일 먼저 정해야 할 것은 출전 클래스이다. 현재 [KSAE Formula 경기진행규정](https://www.ksae.org/jajak/bbs/?number=60778&mode=view&code=J_rule&keyfield=&keyword=&category=&gubun=)은 출전 차량을 A, B의 두 가지 클래스로 분류하고 있다. A클래스는 40kW 초과, B클래스는 40kW 이하 차량이다. 또한 [KSAE Formula 차량기술규정](https://www.ksae.org/jajak/bbs/?number=59879&mode=view&code=J_rule&keyfield=&keyword=&category=&gubun=)에 따라 A클래스는 HV 전압이 150~600VDC로 제한된다.

2. HV 전압  
출전 클래스를 정하면 HV 전압은 자연스럽게 결정된다. B클래스로 출전하는 팀은 굳이 150~200VDC 이상을 사용하지 않으려 할 것이다. 어차피 출력 제한이 걸려 있는데 굳이 배터리 크기 키워가며 전압을 올릴 필요가 없다. A클래스로 출전하는 팀은 기왕 A클래스인거 150~250V는 좀 아쉽고 600V는 무서우니 그 사이 어딘가로 전압을 정하게 될 것이다.
<br><br>
그러면 이 전압 범위에서 쓸만한 모터를 골라 잡으면 된다. 모터 선정은 내가 안 했기 때문에(파워트레인 파트장이 골랐다) 어떤 의식의 흐름으로 Emrax 208이 우리 모터가 되었는지는 잘 모른다.
<br><br>
위에서 정한 HV 전압은 고전압 배터리 팩의 직렬 라인 수를 결정한다. 앞서 우리 팀이 70s7p 구성을 사용한다고 했는데, 이는 전지를 병렬로 7개 연결하고, 이 세트를 직렬로 70개 연결했다는 뜻이다. 리튬이온 전지의 최고 전압은 대개 4.2V이므로, 70직렬을 사용하면 시스템 최고 전압은 자연스럽게 <dfn>4.2 * 70 = 294V</dfn> 가 된다.

3. HV 배터리 용량  
그 다음으로 HV 배터리의 용량을 정해야 한다. HV 배터리 용량은 다음과 같은 의식의 흐름으로 결정됐다.
<br>
    1. 가장 긴 주행 시간을 요구하는 내구 레이스는 대개 40분 정도 소요된다.
    2. 내구 레이스는 곡선 주로가 많아 평균 rpm이 높게 유지되기 어렵다. 평균 rpm을 1200 정도로 가정하자. (우리 차량은 1200rpm에서 시속 25km/h 정도가 된다.)
    3. 우리가 사용할 모터의 데이터시트를 보자. RPM 대 전력 소모 그래프를 보면 1200rpm에서 모터는 10kW를 사용한다.
    4. 10kW의 전력으로 40분을 주행하면 6.7kWh를 사용한다.
    5. 우리가 사용할 셀인 INR21700-40T는 공칭 전압 3.6V에 용량 4Ah, 총 14.4Wh의 전력량을 가진다. 294V를 만들기 위해 70직렬로 연결한 셀의 전력량은 <dfn>14.4 * 70 ≈ 1kWh</dfn> 이다.
    6. 앞선 계산으로 배터리팩이 최소 6.7kWh는 되어야 하므로, 이를 맞추기 위해서는 7병렬의 구성이 필요하다.
    7. → 70s7p 배터리팩

    계산한 최소 용량이 6.7kWh였는데, 결과적으로 우리의 배터리팩은 7.056kWh가 되었다. 설계 여유가 겨우 5% 수준이다. 실제로 우리 배터리는 용량이 아슬아슬해 아껴 써야 한다.

...라고 생각했는데, 내구레이스 주행 데이터를 분석해보니 전혀 그렇지 않았다. 총 34분 가량을 주행하는 동안 모터는 평균 6.95kW를 사용했다. 평균 주행 속도는 42km/h였다. 데이터로거에 기록된 여러 독립적인 지표를 각각 따로 계산해 보아도 배터리 전체 용량의 52~55% 정도를 사용한 것으로 보인다. 즉, 배터리가 4kWh만 되어도 내구를 충분히 완주할 수 있다는 뜻이 된다.

결국 모터는 전압과 전류의 곱인 전력을 먹는다. 모터가 필요로 하는 적절한 전압 범위 내에서 배터리팩의 총 전력량(kWh)을 필요한 수준으로 맞추기만 하면 된다.

이러한 방식으로 HV 배터리의 전압과 용량이 정해진다. 그러나 이는 각각 배터리의 직렬, 병렬 셀 개수에 영향을 받고, 총 사용하는 셀의 개수는 그 둘의 곱이다. 더 많은 셀은 더 비싸고 더 무거운 배터리팩을 의미한다. 가난한 우리는 적당한 타협점을 찾을 수밖에 없다. 참고로 우리 배터리 팩의 무게는 거의 드라이버의 몸무게와 맞먹는다.

### 끝났나요?
아직 BMS와 모터 컨트롤러, 그리고 HV 주요 부품이 남았다. BMS는 Battery Management System이다. 뉴스에서 전기차에 불나서 활활 타는 것을 본 적 있는가? BMS는 각 셀의 전압과 온도, 충방전량을 감시하여 소중한 배터리가 잿더미로 변하는 것을 막아주는 역할을 한다. BMS를 정하는 건 뭐 쉽다. 직렬 라인 수를 정했으니 그만한 직렬 라인을 지원하는 BMS를 하나 골라 잡으면 된다.

모터 컨트롤러는 모터를 제어한다. 당연한 소리다. 아마 거의 대부분의 팀에서 교류 모터를 사용할 것이다. 교류 모터는 같은 출력의 직류 모터에 비해 싸기 때문이다. 배터리에서 나오는 직류로 모터를 굴리기 위해서는 직류를 교류로 바꿔주어야 한다. 이 역할(인버터)에 겸해 모터의 회전을 제어하는 역할을 하는 것이 모터 컨트롤러이다. 내연기관 자동차에서 엔진과 변속기가 한 세트이듯이 전기차에선 모터와 모터 컨트롤러가 한 세트이다. 실제로 우리가 사용하는 PM100DX는 인버터 기능 뿐만 아니라 엑셀, 브레이크, 시동 절차, 초기 충전 등 우리가 필요로 하는 많은 기능을 탑재하고 있다.

다음은 짜잘한 HV 부품들이다. 차량기술규정을 만족하기 위해 모든 E-Formula 차량은 HVD와 AIR라는 부품이 있어야 한다. 그리고 고전력이 지나가는 HV 배선은 편의점에서 파는 소시지보다도 두껍다. 당연히 비싸다.

우리가 사용한 부품들은 이렇다.

|HVD 및 HV 전선|AIR|
|:-:|:-:|
|HVD: [Amphenol HVSL1000082A](https://www.amphenolpcd.com.cn/products-detail/i-709.html) <br> HV 전선: [LS전선 EEXV-SB 50SQ](https://cdn.komachine.com/media/product-catalog/ls-cable-system_48200_owxsdz.pdf)|[한국리레이 XEV9-250F](http://www.hankukrelay.co.kr/m21_view.php?idx=15&cate=1&type=7)|
|![]({{ page.assets }}/hvd.png) <br> <del>ㄴㅇㄱ</del>|![]({{ page.assets }}/air.png) <br> &nbsp;|

<br>

HVD는... 뭐 한 번 샀으니 계속 같은 종류를 쓰기는 했지만 썩 좋은지 잘 모르겠다. 터미널이 빠져야 할 때는 안 빠지고 빠지지 말아야 할 때 빠진다. 커넥터를 잠그는 이빨이 난데없이 부러지기도 했다. 와중에 플러그와 리셉터클 한 세트가 20만 원 정도 한다. 작년 이맘때쯤엔 HVD 하나를 망치고 다같이 분노에 차서 해머로 깨부수기도 했다.

<div class='center'>
    <img src='{{ page.assets }}/hvd_destruction_1.png' style='height: 250px;'>
    <img src='{{ page.assets }}/hvd_destruction_2.png' style='height: 250px;'>
    <br> <span style='font-size: .8rem'>아오</span>
</div>

AIR는 무식하게 큰 산업용 릴레이이다. 엄지손가락 한 마디만한 5V 릴레이만 보다가 이런 주먹만한거 보면 내가 지금 뭘 하고 있나 다소 황당하다. 2022년에는 TE Connectivity의 LEV200A4ANA를 AIR로 사용했는데, 올해 한국리레이의 XEV9로 교체했다. 직경은 비슷하지만 XEV9가 훨씬 더 컴팩트한 높이를 가지고 있어 설계하기 좋다. 가격도 훨씬 싸고 국산 제품이라 배송이 금방금방 온다는 엄청난 장점이 있다.

<div class='center'><img src='{{ page.assets }}/air_compare.jpg' style='width: 70%'><br>XEV9 vs LEV200A4</div>

## 회로 설계에 관한 팁
많은 분들이 제어 회로 설계는 어떻게 시작해야 하는지, 하기 전에 무엇을 공부해야 하는지에 대해서도 여쭤 보셨다. 우리가 설계해야 하는 회로들은 모두 그다지 복잡한 로직을 요구하지 않는다. 알아야 할 사전 지식은 그렇게 많다고 생각하지 않는다. 대개 고등학교에서도 배운 것들이다.

1. 기초 회로이론(V = IR, P = VI, 직렬/병렬 회로의 특성(KCL 및 KVL과 전압 분배), 간단한 RLC 회로, Pull-Up/Pull-Down 저항, Push-Pull과 Open Drain/Open Collector 회로)
2. 릴레이, 다이오드, 선형 레귤레이터 사용법(사용법이랄게 없는 소자들이다.)
3. 트랜지스터와 MOSFET의 스위칭 동작 : 정말 많이 사용한다. 확실히 알아두면 크게 도움이 된다.
4. 555 타이머와 LM311 비교기 IC 사용법 : VI, TSAL, BSPD, RTDS 등에 두루 사용된다.

정말 솔직하게 이 정도면 충분하다고 생각한다. 사전 지식 공부하는데 너무 많은 시간을 들이지 말고 일단 설계해서 빵판에 테스트해보는 걸 추천한다. 회로이론 공부할 시간에 규정 한 시간 더 뒤져보는게 훨씬 낫다. 일단 들이받아 보라.

만능기판 제작과 PCB 설계 중에 어떤게 더 나은지 여쭤보는 분도 꽤 계신데, 실제 차량에 들어갈 기판은 무조건 PCB로 만드는 걸 권장한다. 처음에는 PCB 설계할 때 약간 헤멜 수 있겠지만, 이후에 들일 시간과 노력을 생각하면 PCB가 압도적으로 유리하다. 만능기판은 이미 완성된 PCB에 빼먹은 자그마한 회로 추가할 때나 쓰게 된다.

<div class='center'><img src='{{ page.assets }}/perfboard.jpg' style='width: 70%'><br>이럴 때 쓴다.</div>

회로도를 그리고 처음 실제로 테스트할 때는 브레드보드를 사용하는 것을 추천한다. 부품 재사용과 교체, 배선 변경이 쉽다. 그러나 차에 달 때 부품이 덜렁거리는 브레드보드를 쓸 수는 없는 노릇 아닌가? 만능기판에 실제 사용할 기판을 만들면 이런 모습이 된다.

<div class='center'><img src='{{ page.assets }}/perfboard_1.jpg' style='width: 70%'></div>

회로의 극히 일부만 구현한 건데도 제작에 12시간이 걸렸다. 그럴 시간에 그냥 PCB 설계하고 배송을 기다리는 편이 200배 낫다. 나중에 배선이 쌓이면 이게 어떤 전선인지 구분도 안 될 뿐더러, 꽂은 부품의 다리에 전선을 붙이는 방식이다 보니 다리 하나에 전선 세 개씩 붙어 있으면 부품 교체도 어렵다. 깔끔하게 만들기도 어렵다. 한 번이라도 만능기판에 회로 만들어 본 분이라면 이게 얼마나 깔끔하게 만든 것인지 아실 것이다.

세상이 좋아져서 KiCAD에서 PCB 설계하고 [https://jlcpcb.com](https://jlcpcb.com/) 에서 거버 파일만 업로드하면 바로 가격이 나오고 주문을 넣을 수 있다. 중국 업체인데, 토요일에도 생산을 한다. 생산은 3~4일이면 완료되고 최소 수량은 5장이다. 웬만하면 2만 원 이하로 제작할 수 있다. 배송비에 좀 투자하면 주문 넣고 1주일이면 받아볼 수 있고, 2달러 정도 하는 저렴한 배송으로는 주문부터 수령까지 3주 정도 걸린다.

## 퓨즈 선정에 관한 팁
퓨즈는 과전류가 흐르면 끊어져 회로를 보호하는 안전 장치이다. 차량기술규정에서 명시하는 퓨즈에 관한 규정은 다음과 같다.

* 모든 과전류 보호 장치는 그 장치가 보호하려는 시스템의 가장 높은 전압보다 높은 정격 전압을 가져야 한다.
* DC에 사용되는 과전류 보호 장치는 DC에 대한 정격을 가져야 하고 시스템 전압 이상의 DC정격전압을 가져야 한다
* 모든 과전류 보호 장치는 시스템의 이론적인 단락(short) 전류보다 높은 차단용량의 전류(interrupt rating)를 가져야 한다.

우리 차량은 LV, HV 모두 DC만을 사용한다. 그러니 우리가 사용하는 모든 퓨즈는 DC 정격 전압이 존재해야 한다. 250VAC만 적힌 퓨즈는 검차장에서 태클이 걸릴 확률이 크다.

HV 퓨즈는 배터리 팩이 방전할 수 있는 최대 전류(개별 셀 최대 방전 전류 * 병렬 라인 수)보다 큰 정격 전류를 가져야 한다. LV 퓨즈는 LV 시스템 전체가 사용하는 전류의 합보다 큰 정격 전류를 가져야 한다. 이렇든 정격 전류(amperage rating)을 정하는 것은 쉽다.

문제는 차단 용량(interrupt rating)이다. 차단 용량은 전류가 퓨즈를 끊어놓는 데에서 그치지 않고, 퓨즈 자체를 터뜨려 버리는 전류를 의미한다. 그러니 규정에 이론적인 단락 전류보다 차단 용량이 커야 한다고 명시하는 것이다.

그럼 이제부터 차단 용량을 계산해 보자. 먼저 HV 퓨즈부터 시작한다. 우리 차량의 HV 최고 전압은 294V이다. 그리고 INR21700-40T 셀을 사용한다. 셀의 데이터시트에는 내부 저항의 상한선이 표시되어 있다.

<div class='center'><img src='{{ page.assets }}/inr21700.png'></div>

그러니 이 셀의 내부 저항을 12mΩ라고 해 보자. 우리는 이 셀을 70s7p 구성으로 사용한다. 우선 셀 7개를 병렬로 연결하면 내부 저항은 1/7로 줄어든다. 이것을 다시 70직렬로 연결하면 내부저항은 70배로 늘어난다.

즉, <dfn>(배터리 팩의 내부 저항) = (개별 셀의 내부 저항) / (병렬 라인 수) * (직렬 라인 수)</dfn> 이 된다.

계산해보면 우리 배터리 팩의 내부 저항은 120mΩ가 된다. 이 HV 배터리의 양 극을 쇼트내면 전류 경로에 저항은 팩의 내부 저항밖에 존재하지 않는다. 즉 <dfn>I = V / R</dfn> 이므로, <dfn>294 / 0.120 = 2450(A)</dfn> 가 이론적인 단락 전류가 된다. 그러므로 차단 용량은 2.5kA보다 높아야 한다.

한편 LV 배터리로는 4s3p INR18650-35E 배터리를 사용한다. 이 셀의 내부 저항은 35mΩ이고, 팩의 내부 저항은 47mΩ가 된다. 최대 전압은 16.8V이므로 이론 단락 전류는 360A이다. 즉, 인터럽트 레이팅이 360A 이상인 퓨즈를 사용해야 한다.

HV 퓨즈야 원래 크고 무식하니 웬만하면 차단 용량이 차고 넘친다. 그러나 우리가 흔히 아는 유리로 된 LV 퓨즈는 차단 용량이 수십A에 그친다. 그러니 규정을 만족하고 싶다면 세라믹 퓨즈를 사용해야 한다. 세라믹 퓨즈는 흔히 사용하는 5.2mm(D) * 20mm(L) 크기에서도 차단 용량이 1500A씩 나온다.

요약하면, DC 정격 전압이 데이터시트에 존재하는 퓨즈 중 정격 전류가 원하는 수준이어야 하고, 차단 용량이 충분한 세라믹 퓨즈를 LV 퓨즈로 사용하면 된다. 규정 맞추기 참 힘들다.

## 응원사
이 정도면 HV 시스템을 어떤 식으로 설계하고 차량에 어떤 부품들이 필요한지, 어떤 것들을 준비하면 되는지 약간은 감이 잡히지 않았을까 생각한다. 모든 항목을 다 커버할 수는 없으니 어느 정도는 직접 겪어 보면서 하나씩 갖춰 나갈 필요가 있다. 원래는 각 주요 부품 가격도 적어보려 했지만 다소 민감한 면이 있어 생략했다. 이 글에 언급한 부품 값만 다 더해도 깡통 K3 가격 정도는 거뜬히 나올 듯하다.

사실 이런 전체적인 시스템 규격을 정한 것이 거의 2년 전이라 모든 과정이 잘 기억나지는 않는다. 우리가 딱히 훌륭한 설계를 한 것도 아니지만, 처음 시작하는 팀에서 겪을 시행착오와 시간 소모를 조금이나마 줄였으면 하는 마음에 처음 부품 정하던 기억을 더듬어 적어 보았다. 새로 시작하는 모든 팀들을 응원한다.

{% include_relative index.md %}
