---
title: 1. HV 시스템 개요
description: E-포뮬러 전기시스템 제작기
category: e-formula
assets: /assets/posts/e-formula/2023-08-29-hv-introduction
image: /assets/posts/e-formula/2023-08-29-hv-introduction/hvbatt.jpg
layout: post
---

### 안내

**본문은 포럼의 [1. HV 시스템 개요](https://dnf.luftaquila.io/t/e-formula/22) 에서 읽으실 수 있습니다.**

{% include_relative notice.md %}

{% include_relative index.md %}

## HV 시스템 개요
HV 시스템은 모터를 구동하기 위한 전력을 차체 내에 비축하고 있다가 필요할 때 모터에 전달한다. HV 배터리 팩과 모터 컨트롤러, 모터로 구성된다. 각각 전원과 제어기, 부하이다. 사실상 이 셋만 있으면 차량은 동력을 얻어 앞으로 굴러갈 수 있다.

그러나 HV 계통은 고전압을 사용하기 때문에, 무슨 일이 있어도 LV와 완벽하게 절연되어 있어야 한다. 우리는 안전과 규정을 맞추기 위해 HVD, 에너지미터 등 몇 가지 요소를 추가해야 한다. 여기서는 각 구성 요소에 대해 알아야 할 개념에 대해서만 간단하게 알아보고, 회로와 함께 각 요소를 설계하는 것은 이후에 보다 상세하게 다룰 것이다.

### 1. HV 배터리
고전압 배터리 팩은 모터를 구동하는 데 필요한 에너지를 저장하고 이를 안전하게 유지한다.

<div class='center'><img src='{{ page.assets }}/hvbatt.jpg'></div>

배터리 팩 내부에는 몇 가지 예외를 제외하면 LV 시스템이 들어갈 수 없다. 예외 항목들은 차량기술규정 제 63조에 나와 있으며 AIR, BMS, IMD, TSAL, 냉각 팬, 초기충전 및 방전 회로, HV DC-DC 컨버터이다.

HV 배터리는 설계를 정말 잘 해야 한다. 냉각이나 구조는 물론이고 조립성도 반드시 신경을 쓰기 바란다. 그렇지 않으면 분해-조립에 꼬박 반나절이 걸리게 된다.

배터리 팩에 들어가는 요소들은 다음과 같다.

#### 1-1. 리튬이온 전지
전기차는 에너지 밀도가 높은 리튬이온 전지를 여러 개 연결하여 사용한다. 대개 18650 또는 21700 규격이다. 각각 직경 18mm, 높이 65mm의 원통형(0) 셀, 직경 21mm, 높이 70mm의 원통형 셀이라는 뜻이다. 우리 팀은 삼성SDS의 INR-21700-40T 셀 490개를 사용한다.

리튬이온 전지의 전압은 완전 충전 시 4.2V, 완전 방전 시 2.5~3.1V이다. 완전 방전 전압은 데이터시트에 명시된 값에 따라 배터리 관리 시스템(BMS)이나 배터리 보호회로(PCM)가 정한다. 완전 방전에 가깝게 방전할수록 배터리 음극이 영구적인 손상을 입어 배터리의 수명과 용량이 조금씩 감소한다. 한편 용량은 (m)Ah 단위를 사용해 표시한다. 한 시간동안 방전할 수 있는 전류의 양을 의미한다. 용량이 4,000mAh인 배터리는 4A의 전류를 1시간동안 방전할 수 있다.

<div class='center'><img src='{{ page.assets }}/hv_pack.jpg'></div>

한편 배터리 팩을 만들 때 모든 셀을 한번에 통째로 다 연결해서는 안 된다. 반드시 세그먼트 단위로 나누어 구성해야 하며, 각 세그먼트의 최대 전압은 120V를 초과할 수 없다. 차량기술규정 제 12장 축전지의 제 61조 축전지 3항에 관련 규정이 있다.

#### 1-2. 메인 HV 릴레이 (AIR, Accumulator Isolation Relay)
고전압을 사용하는 만큼 배터리팩은 사용하지 않을 때 적절히 꺼져 외부와 절연될 필요가 있다. 이를 위해 배터리의 양 극에 릴레이를 달아놓은 것이 AIR이다. HV 배터리 팩의 +/- 단자를 각각 끄고 켜는 스위치라고 생각하면 된다. HV 전류를 실제로 팩 외부로 흘려줄 수 있어야 하는 만큼 크고 무식하게 생겼다. 아마 [¼. 시스템 설계 가이드](https://luftaquila.io/blog/e-formula/design-guide/)에서 사진을 보았을 것이다.

앞으로 빈번하게 사용할 ***HV 활성화*** 라는 용어는 AIR를 닫아 HV가 차량에 공급되고 있는 상태(배터리팩 외부에 HV가 존재하는 상태)를 의미한다.

* 릴레이는 전기로 동작하는 스위치이다.

    <div class='center'><img src='{{ page.assets }}/1.png'></div>
    <div class='center'><img src='{{ page.assets }}/relay.gif'></div>

    릴레이의 코일에 전압을 가하면 코일은 전자석이 되어 접점을 끌어당긴다. 접점은 아래쪽 단자와 붙어 전기적으로 연결된다. 전원을 끊으면 스프링에 의해 점점은 원래 자리로 돌아가게 된다. 사람의 손 대신 전기 신호(전압)을 이용해 접점을 개폐하는 스위치라고 생각하면 된다.

    릴레이에는 NO와 NC, COM 단자가 있다. NO 단자는 Normally Open으로, 코일에 전원이 없는 평소 상태에서 열려 있어 전기가 흐르지 않는다. 코일에 전압을 걸면 COM 단자와 연결된다. 반대로 NC 단자는 Normally Closed으로 평소에 닫혀 COM과 연결되어 있다가 코일에 전압을 걸면 열리게 된다.

#### 1-3. 절연 감시 장치 (IMD, Isolation Monitoring Device)
HV 시스템은 LV 시스템과 완벽한 절연을 유지해야 한다. 절연이 제대로 유지되지 않으면 탑승자는 차체 프레임에 접촉하는 것만으로도 HV에 감전될 수 있다. IMD는 HV 계통과 LV 계통이 서로 적절한 절연(일정 값 이상의 저항)을 유지하고 있는지 감시한다. 대회 측에서 사용하는 모델을 정해 놓아 Bender사의 ISOMETER IR155-3204를 사용하게 된다.

그냥 손바닥보다 조금 더 큰 PCB이다. 실제로 구매하면 20~30만 원 가까이 하지만 국내 수입사인 원리솔루션에서 자작차 팀에게 무상으로 지원하곤 한다.

#### 1-4. 배터리 관리 시스템 (BMS, Battery Management System)
서로 병렬로 연결된 셀들은 시간이 지나면 자연스럽게 같은 전압을 유지한다. 수위가 서로 조금씩 다른 수조들 사이의 수문을 모두 개방하면 모든 수조의 수위가 같아지는 것과 같다.

그러나 직렬로 연결된 셀들은 그렇지 못하다. 여러 개의 직렬 셀로 구성된 배터리는 적절히 관리하지 않으면 직렬 라인마다 충전량(전압)이 달라지는 상황이 생길 수 있다. 이 때 배터리를 사용하면 각 셀은 충전량 편차에 무관하게 동일한 충방전을 한다. 결과적으로 특정 셀이 다른 셀보다 더 많이 충전되거나 더 많이 방전되는 상황을 초래한다. 이는 과충전, 과방전으로 이어지고 악명 높은 배터리 화재 사고를 일으킨다.

우리의 값비싼 배터리가 잿더미로 변하는 것을 막기 위해 BMS는 배터리의 모든 직렬 라인을 감시하며 셀 밸런싱을 수행하고, 셀 온도를 감시하여 과열로 인한 배터리 열폭주를 막는다. 또한 홀 센서를 통해 배터리에 흐르고 있는 전류를 파악한다.

BMS는 각 셀의 전압을 측정할 뿐이지 고전압 배터리 전체의 +/- 단자에 연결되어 있지는 않다. 따라서 BMS 자체가 배터리에 흐르는 전류를 제한할 수는 없다. 하지만 BMS는 디지털 출력을 통해 AIR를 제어하고, CAN 통신을 통해 부하인 모터 컨트롤러와 통신하여 최대 방전 가능 전류 값을 전송한다. 모터 컨트롤러는 BMS로부터 수신한 최대 방전 전류 이상으로 전류가 흐르지 않도록 모터를 통제한다. 또한 BMS는 홀 센서를 통해 최대 방전 전류보다 큰 전류가 배터리 팩에서 나가고 있다면 AIR를 꺼 HV를 차단한다.

#### 1-5. 초기 충전 회로 (Precharge Circuit)
모터를 제어하는 모터 컨트롤러는 회로에 커패시터(축전기)를 가지고 있다. AIR를 닫아 HV 배터리의 전압을 모터 컨트롤러에 공급하면 이 축전지들에는 한 번에 구동계통 전압이 걸린다. 이 순간 높은 전압차로 인해 큰 돌입 전류가 흐르게 되며, 이는 모터 컨트롤러를 손상시킬 수 있다. 따라서 초기 충전 회로를 통해 우리는 미리 모터 컨트롤러의 축전지를 배터리 전압의 95% 정도까지 서서히 충전한다. 이후 AIR를 닫음으로써 돌입 전류로 인한 손상을 방지하게 된다. 단순한 RC 회로로 구성되어 있다.

<div class='center'><img src='{{ page.assets }}/precharge.jpg'><br>초기충전 중 HV 전압을 오실로스코프로 측정했다.</div>

0V부터 216V까지 RC 충전을 통해 1초에 걸쳐 서서히 충전한 후 AIR가 닫혀 250V가 되는 모습을 볼 수 있다.

#### 1-6. 고전압 표시 장치 (TSAL, Tractive System Active Light)
TSAL은 차량에 현재 어떤 전기 시스템이 활성화되어 있는지를 표시하는 표시등이다. 차량에 LV 전원이 공급되면 녹색으로 점등된다. 여기서 HV까지 활성화하면 적색으로 점등되어 차량에 HV가 공급되고 있다는 사실을 쉽게 식별할 수 있도록 한다.

LED 자체는 차량 주변 어디에서나 볼 수 있도록 차량 상단에 부착된다. 그러나 LED를 점등하는 회로는 AIR 제어 신호 등을 이용해 HV의 상태를 추정하여 작동해서는 안 된다. 반드시 HV 전압을 직접 이용하여 점등되어야 한다. 따라서, TSAL 회로 자체는 배터리 팩 내부에 존재하고 LED 전원 배선만 차량 외부로 나가게 된다.

<div class='center'><img src='{{ page.assets }}/rain.jpg'><br>우천검사 중인 우리 차량이다. 상단에 적색으로 점등된 TSAL을 확인할 수 있다.</div>

#### 1-7. 전압 표시 장치 (VI, Voltage Indicator)
TSAL은 배터리팩이 차량에 장착되었을 때만 점등된다. 그러나 배터리팩이 차량에 장착되지 않았을 때에도 충전을 하면 HV가 배터리팩 밖에 존재하게 된다. 이 때 HV가 활성화되었는지를 식별할 수 있도록 배터리팩에 설치되는 적색 HV 활성화 표시등이다. TSAL과 정확히 같은 역할을 수행한다. 마찬가지로 소프트웨어 처리나 AIR 제어 신호로 HV 상태를 추정해서는 안 되고, 직접 HV 전압을 사용하여 점등되어야 한다.

<div class='center'><img src='{{ page.assets }}/vi.jpg'><br>밝을 필요도 없다. 그냥 배터리팩 외부에서 확인할 수 있으면 된다.</div>

습관적으로 VI라고 부르는데 검차 오피셜들은 대개 AVI(Accumulator Voltage Indicator, 구동시스템 전압 표시장치)라는 용어를 사용하는 듯하다. 처음에 못 알아먹어서 조금 당황했다.

#### 1-8. HV 퓨즈
차량기술규정 제 63조에 의해 축전지박스는 반드시 하나 이상의 메인 퓨즈를 포함해야 한다.

<div class='center'><img src='{{ page.assets }}/fuse.jpg'></div>

좌측의 하얀 원통형 물체가 HV 퓨즈인 L50QS250이다. DC 500V까지 사용 가능하며 250A에서 퓨즈가 끊긴다. 최대 용량 interrupt rating은 50kA이다.

<br>

### 2. HV 박스
차량기술규정에 따라 우리는 배터리 팩에서 모터 컨트롤러로 가는 HV 배선을 HVD라는 커넥터를 이용해 직접 끊을 수 있어야 한다. 또한, TSMP라는 HV 전압 측정 포인트가 있어야 하고 에너지미터가 HV 경로 중간에 존재해야 한다. HV 차단 이후 모터 컨트롤러의 잔류 HV 전압 처리를 위한 방전 회로도 있어야 한다. BSPD를 위한 전류 측정 홀 센서도 필요하다.

하지만 HV 배선은 굉장히 두껍고 대개 쉴드 처리되어 있어 전선 중간에서 접점을 확보하기 어렵다. 그렇다고 이걸 전부 배터리팩 내부에서 처리하려면 배터리팩이 말도 안 되게 복잡해진다. 따라서 우리 팀은 이러한 HV 구성 요소를 넣기 위한 HV 박스를 별도로 두고 있다.

<div class='center'><img src='{{ page.assets }}/junction.jpg'><br>정션 박스 내부. 에너지미터 장착 지점에서 링 터미널을 통해 HV 접점을 확보한다.</div>

#### 2-1. 고전압 분리기 (HVD, High Voltage Divider)
HV 배터리의 각 단자는 앞서 살펴본 것처럼 AIR가 제어한다. 그런데 우리는 AIR에 모종의 문제가 생겨 AIR의 전원을 끊어도 HV 회로가 닫힌 상태를 유지하는 상황을 생각해 볼 수 있다. 이러한 상황에서 HV 배선을 직접 물리적으로 끊어 모터 컨트롤러의 HV 전원을 차단할 수 있도록 하는 플러그가 바로 HVD이다. 단순하게 잘 절연된 플러그와 HVD의 분리를 감지하기 위한 인터락으로 구성된다.

<div class='center'><img src='{{ page.assets }}/hvd.jpg'></div>

인터락은 정말 별 거 없다. 사진의 네모 부분이 인터락이다. 상대물에도 서로 합선되어 있는 두 접점이 있다. 커넥터가 분리되면 해당 배선이 끊어져 커넥터 분리를 감지할 수 있다.

#### 2-2. 에너지미터
에너지미터는 대회 측에서 제공하는 장치이다. 주행 중 HV 전압과 전류를 측정해 클래스별 규정된 최대 출력을 초과하지 않는지 측정한다. 또한 대회가 끝나면 각 팀에게 분석을 위해 측정 데이터를 대회 측에서 제공한다.

HV 전류를 측정하기 위해 HV 배선을 끊고 중간에 끼어들어야 한다. 안에 홀센서가 들어있는지 션트 저항이 들어있는지 모르겠지만 참 번거로운 시스템이다. 검차를 통과해야만 지급받을 수 있어, 그 전까지 끊긴 HV 배선을 이어줄 더미 에너지미터가 필요하다. 실물 에너지미터 케이스가 3D 프린팅 구조물인 걸 보면 대회 측에서 자작한 듯하다.

에너지미터의 3D 모델과 커넥터 정보, 핀맵은 [대회 공지사항](https://www.ksae.org/jajak/bbs/?number=58334&mode=view&code=J_notice&keyfield=all&keyword=%EC%97%90%EB%84%88%EC%A7%80%EB%AF%B8%ED%84%B0&category=&gubun=)에서 확인할 수 있다.

#### 2-3. 방전 회로
앞서 초기충전 회로에서 설명한 것처럼, 모터 컨트롤러에 들어있는 커패시터는 전기를 저장한다. 이 커패시터는 HV가 끊겨도 자연 방전되기 전까지 구동계통 전압으로 충전되어 있다. 방전 회로는 이 잔류 고전압을 제거하기 위한 것이며, 초기충전 회로와 사실상 동일하게 작동한다. 커패시터에 부하 저항을 하나 붙여 RC 방전을 통해 열로 태우는 간단한 구조이다.

#### 2-4. 구동시스템 전압 측정 포인트 (TSMP, Tractive System Measuring Point)
TSMP는 전기시스템 검차에서 구동시스템 전압을 직접 측정하기 위한 단자이다. IMD 검사에서도 활용된다. HV 배선의 각 극에서 10kΩ 전류제한저항을 거쳐 연결되는 바나나 잭이다. 측정 포인트인 바나나 잭의 위치 자체는 자유이나, HV 접점이 필요해 HV 박스에서 가져오게 된다.

<div class='center'><img src='{{ page.assets }}/tsmp.jpg'><br>아래쪽에 HV+, HV-라고 표시된 것이 TSMP다.</div>

<br>

### 3. 모터 컨트롤러와 모터
교류 모터는 직류 모터에 비해 구조적으로 유리하여 같은 크기에서 출력이 좋고 저렴하며 수명이 길다. 이러한 이유로 우리의 전기차 또한 AC 모터를 사용한다.

반면 우리의 배터리 팩은 직류이다. 따라서 모터를 구동하기 위해 배터리의 DC를 AC로 변환하고 위상을 제어해야 할 필요가 있다. 이를 인버터라고 한다. 직류를 3상 교류로 만들기 위해 고속으로 작동하는 MOSFET을 이용한 3상 스위칭 회로를 사용한다.

이 인버터에 차량 전용으로 속도 제어, CAN 통신, 릴레이 제어 등 다양한 기능을 추가한 것이 모터 컨트롤러이다.

### 4. 냉각 시스템
차량의 LV 계통은 소모 전류를 다 합쳐도 보통 1A가 채 되지 않는다. 그런데 여기에 배터리 냉각 팬, 냉각수 펌프, 라디에이터 팬을 추가하면 LV 소모 전류가 순식간에 10A가 되어 버린다. LV 전류 소모가 커지면 자연스럽게 LV 배터리가 커질 수밖에 없다. 가뜩이나 좁은 차량에서 LV 배터리가 크고 무거워지면 상당히 곤란하다. 그렇다고 냉각을 포기할 수도 없는 노릇이다.

그러나 우리 차량에는 이미 차고 넘치는 에너지원이 있다. 바로 HV 배터리이다. LV 배터리로는 저전력 제어 회로만을 작동하고, 큰 전력을 사용하는 냉각 계통은 HV 배터리를 통해 구동하기 위해 고전압 DC-DC 컨버터를 사용할 수 있다. 이 컨버터는 필수는 아니고, LV 배터리 크기를 줄이기 위한 방법이다.

우리 팀은 300V to 12V 컨버터인 [QHL300300S12](https://www.mouser.kr/datasheet/2/942/SF_QHL300-1664261.pdf)를 배터리팩 내부에 넣어 사용했다. 절연형 DC-DC 컨버터이기 때문에 12V 출력이 입력인 HV 계통과 그라운드를 공유하지 않는다.

{% include_relative index.md %}

</details>
