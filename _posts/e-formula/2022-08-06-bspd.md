---
title: 6. 제동시스템 타당성 검증 장치(BSPD)
description: E-포뮬러 전기시스템 제작기
category: e-formula
assets: /assets/posts/e-formula/2022-08-06-bspd
image: /assets/posts/e-formula/2022-08-06-bspd/bspd.png
layout: post
---

{% include_relative index.md %}

## BSPD 개요
Brake System Plausibility Device, BSPD는 제동시스템 타당성 검증 장치이다. BMS FAULT, IMD FAULT와 함께 차단 회로의 래칭 릴레이를 작동시켜 AIR 전원을 차단하는 구성 요소이다. 모터가 5kW 이상의 전력을 소모하고 있을 때 차량이 일정량 이상의 제동을 하는 상황이 500ms 이상 지속되면 AIR를 개방하여 HV를 차단하는 기능을 한다. 차량기술규정 59조에 관련 규정이 있다.

즉 BSPD는,
1. 모터 전력을 측정
2. 브레이크 페달 입력을 측정
3. 500ms 이상 두 조건이 충족되었을 때 신호 출력

의 기능을 할 수 있어야 한다. 여기서 가장 까다로운 것은 모터 전력을 측정하는 부분이다. 규정에서 정하는 5kW의 전력만 하더라도 아파트 엘리베이터 한 대를 끌 수 있는 규모의 전력이다. 전력 라인에 션트 저항을 하나 끼워놓고 양단 전압차를 재는 식으로 전력을 측정하려 했다가는 시스템이 잿더미로 변해버릴 것이다.

이러한 이유로 전력 측정에는 비접촉식인 홀 센서를 이용한다. 우리 팀은 처음에는 [HTFS-200P](https://www.lem.com/en/htfs-200p){:target="_blank"}{:class='external'}라는 센서를 선정했으나 재고 없음으로 판매자한테 뒤통수를 맞은 후 디웰전자의 [TFC30P2VS05150A](https://eleparts.co.kr/goods/view?no=9624610){:target="_blank"}{:class='external'} 모델로 교체했다. 이 홀 센서들은 고리 모양 안으로 전선을 통과시키면, 그 전선에 흐르는 전류에 따라 0 ~ 5V의 아날로그 전압을 출력한다.

한편, 이 센서들은 산업용이라 측정 범위가 굉장히 넓어서 3~400A의 무시무시한 전류까지도 측정할 수 있다. 그러나 현실 세계의 여느 센서가 그렇듯 출력이 모든 구간에서 완벽히 선형적이지는 않다. 그래서 이 센서들은 측정 가능 범위와 별개로 Nominal Current라는 값이 따로 있다. 이 값은 센서가 그 전류값 즈음에서 가장 괜찮은 선형성을 보여준다는 뜻이다. 우리 센서 데이터시트를 예시로 한 번 살펴보자.

<div class='center'><img src='{{ page.assets }}/hall.png'></div>

이 센서의 측정 범위는 0~375A이다. 한편, nominal 값은 150A이고 이 때 센서 출력은 2.0V라는 것을 알 수 있다. 150A에서는 2.0V가 나오고, 측정 전류와 출력 전류가 가장 비례해서 변화하는 구간이 150A 전후라는 것이다. 규정상 모터가 5kW 전력을 소비하려면 294V에서 17A가 흘러야 한다. 17A에서 출력은 약 0.2V 정도이다. 

## 회로 구성

<div class='center'><img src='{{ page.assets }}/bspd.png'></div>
회로 구성은 다음과 같다. BSPD는 차단 회로에 포함되는 요소로, 회로의 아래 쪽 절반이 BSPD 회로이다. BSPD는 HV 활성화 상태에서 작동하므로 `LV_ACTIVE` 라인에서 전원을 공급받아 레귤레이터를 통해 5V로 바꾸어 사용한다.

BSPD 앞 부분에 부품이 빠져 있는 자리는 본래 설계에서 BD77501G라는 부품이 들어 있던 자리이다. 홀 센서의 작동 출력이 0.2V로 상당히 낮아서 임피던스를 높여 노이즈 저항성을 개선하기 위해 추가했던 부품이라고 한다. 이 부분은 내가 설계한 것이 아니라 정확한 원리는 알아보지 않았다. 어쨌거나 BD77501G가 들어 있는 상태에서 원하는 대로 정상 동작하는 것은 확인했다.

이후 이 설계대로 PCB를 주문했는데, 사고가 생겼다. BD77501G는 SSOP5라는 패키징 규격을 사용하는데, 제일 긴 면이 2.9mm에 불과해 잘 보이지도 않는 크기이다. 그런데 PCB를 주문해서 완성품을 받아본 이후에 이 부품 풋프린트의 핀 번호가 데이터시트와 다른 것을 발견했다. 부품 크기가 작아 PCB상에서 오류를 수정할 수도 없었고, 대회가 코앞이라 생략한 채로 그대로 LM311 비교기에 입력하기로 했다.

그래서 우리 팀의 BSPD는 0~5V 아날로그 입력인 홀 센서와 브레이크 압력 센서 출력을 받아 각각을 LM311 비교기의 2번 입력 핀으로 바로 집어넣는다. 비교 신호인 3번 핀에는 5V 레귤레이터 출력 전압을 저항으로 전압 분배하여 원하는 전압으로 설정해 입력한다. 따라서, 회로의 R10, R11, R14, R15는 상황에 맞추어 각 팀이 필요로 하는 전압으로 설정되어야 한다.

LM311에 의해 특정 값 이상인지 비교된 각 센서 출력은 74LVC1G08 AND 게이트로 입력된다. 우리 팀은 이미 있는 부품을 사용하기는 했으나, AND 게이트는 트랜지스터 2개로도 아래와 같이 쉽게 구현이 가능하다.
<div class='center'><img src='{{ page.assets }}/AND_Gate.gif'></div>

두 센서의 BSPD 동작 조건이 모두 참일 때, AND 게이트는 555 타이머를 동작시켜 500ms동안 조건이 유지되는지 확인한다. 시간 조건 또한 충족되면 555 타이머의 3번 핀이 HIGH 상태가 된다.

그러나 우리 차단 회로의 모든 Latched Fault는 정상 상태에서 12V HIGH, Fault 상황에서 0V LOW여야 한다. 따라서 타이머 출력으로 작동하는 트랜지스터 하나가 GND와 스위칭 동작을 함으로써 FAIL LOW 출력을 만들게 된다.
<br><br>

{% include_relative index.md %}